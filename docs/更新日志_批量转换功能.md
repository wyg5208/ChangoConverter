# 更新日志 - 批量转换功能

## 版本 1.0.0 - 批量转换功能上线

**发布日期**: 2024-10-23

### 🎉 新增功能

#### 1. 批量转换模式
- ✅ 新增"批量转换（文件夹）"模式，支持一次性转换整个文件夹
- ✅ 自动递归扫描所有子文件夹
- ✅ 自动识别30+种支持的文件格式
- ✅ 转换后的文件自动保存到源文件所在文件夹

#### 2. 智能文件扫描
- ✅ 使用`Path.rglob()`实现高效的递归文件扫描
- ✅ 自动去重，避免重复处理同一文件
- ✅ 支持所有Pandoc支持的输入格式扩展名

#### 3. 转换模式切换
- ✅ 单选按钮切换"单文件转换"和"批量转换"模式
- ✅ 界面动态适配不同模式的需求
- ✅ 批量模式下自动隐藏输出目录选项（自动保存到源文件夹）
- ✅ 显示友好的提示信息

#### 4. 增强的日志输出
- ✅ 批量模式显示详细的扫描和转换进度
- ✅ 实时显示当前处理的文件（例如：[3/15] 处理中...）
- ✅ 为每个转换操作显示结果状态（✓成功 / ✗失败 / ⊘跳过）
- ✅ 完成后显示详细统计信息

#### 5. 智能跳过机制
- ✅ 自动跳过输出文件与输入文件相同的转换
- ✅ 避免意外覆盖源文件

### 📝 代码修改

#### 修改的文件
1. **app_all_function.py** - 主程序文件
   - 添加转换模式选择UI
   - 实现`on_mode_changed()`方法处理模式切换
   - 实现`browse_input_folder()`方法选择文件夹
   - 修改`start_conversion()`支持批量模式
   - 新增`batch_convert_thread()`实现批量转换核心逻辑
   - 更新帮助文档包含批量转换说明
   - 调整UI布局行号以适应新增控件

#### 新增的文件
1. **批量转换使用说明.md** - 详细的使用文档
2. **测试批量转换.md** - 测试指南和验证步骤
3. **更新日志_批量转换功能.md** - 本文件

### 🔧 技术细节

#### 核心实现
```python
def batch_convert_thread(self, root_dir, selected_formats):
    """批量转换线程 - 扫描文件夹并转换所有支持的文件"""
    # 1. 使用Path.rglob()递归扫描所有支持的文件格式
    # 2. 去重处理
    # 3. 逐个文件转换到所有选定的格式
    # 4. 转换结果保存到源文件所在目录
    # 5. 实时更新进度和日志
```

#### UI适配逻辑
```python
def on_mode_changed(self):
    """转换模式改变时的处理"""
    if mode == "single":
        # 单文件模式：显示输出目录选项
    else:
        # 批量模式：隐藏输出目录，显示提示
```

#### 文件扫描策略
- 使用Python `pathlib.Path.rglob()` 方法
- 支持的扩展名存储在 `EXT_TO_FORMAT` 字典中
- 遍历所有扩展名，收集匹配的文件
- 使用集合去重避免重复

### 📊 性能特点

- **内存效率**: 逐个处理文件，不会一次性加载所有内容
- **错误容忍**: 单个文件失败不影响其他文件转换
- **进度反馈**: 实时显示处理进度和状态
- **灵活性**: 支持任意深度的目录结构

### 🎯 使用场景

1. **文档仓库转换**
   - 将整个文档仓库从Markdown转换为HTML
   - 批量生成PDF版本用于分发

2. **格式统一**
   - 将混合格式的文档统一转换为单一格式
   - 例如将Word、HTML、Markdown统一转为PDF

3. **多版本输出**
   - 同时生成多种格式的输出文件
   - 例如同时生成HTML、PDF、DOCX三个版本

4. **文档备份**
   - 将重要文档转换为多种格式备份
   - 确保长期可访问性

### 📋 支持的格式

#### 输入格式（自动识别）
- Markdown系列: `.md`, `.markdown`, `.mdown`, `.mkd`
- Office文档: `.docx`, `.pptx`, `.odt`
- Web格式: `.html`, `.htm`
- 学术格式: `.tex`, `.ltx`, `.rst`, `.org`
- 电子书: `.epub`
- 其他: `.rtf`, `.txt`, `.pdf`, `.ipynb`, `.xml`

#### 输出格式（可选择）
40+ 种格式，包括：
- 文档: DOCX, PDF, ODT, RTF
- Web: HTML5, HTML4
- 标记语言: Markdown, reStructuredText, Org-mode
- 幻灯片: PowerPoint, Beamer, reveal.js
- 电子书: EPUB2, EPUB3
- 其他: LaTeX, DocBook, MediaWiki 等

### 🐛 已知限制

1. **PDF转换**
   - 需要额外安装LaTeX（推荐MiKTeX或TeX Live）
   - 首次转换可能需要下载LaTeX包

2. **文件覆盖**
   - 当前版本会覆盖已存在的同名输出文件
   - 建议在重要文件夹操作前先备份

3. **大文件处理**
   - 非常大的文件（>100MB）可能转换较慢
   - 建议先用小文件测试

### 🔮 未来计划

- [ ] 添加文件过滤选项（按日期、大小等）
- [ ] 支持转换前预览
- [ ] 添加转换配置模板保存/加载
- [ ] 支持多线程并行转换提升速度
- [ ] 添加增量转换（只转换修改过的文件）
- [ ] 支持自定义输出文件命名规则
- [ ] 添加转换历史记录

### 📚 相关文档

- 使用说明: `批量转换使用说明.md`
- 测试指南: `测试批量转换.md`
- 原始文档: `README_app_all_function.md`
- Pandoc文档: https://pandoc.org/MANUAL.html

### 🙏 反馈与贡献

如果您在使用过程中遇到任何问题或有改进建议，欢迎反馈！

---

**版本**: 1.0.0  
**发布日期**: 2024-10-23  
**开发者**: AI Assistant  
**基于**: Pandoc 文档转换工具



